!function(e,t){var a=function(){var e=this;e.removeTradeCallback=null,e.addTradeCallback=null,e.lastPriceCallback=null,e.restoreSession(),e.trades=[],e.connections={gdax:null,bitfinex:null,bitstamp:null},e.socket_openers={gdax:function(){var t=e.connections.gdax=new WebSocket("wss://ws-feed.gdax.com");t.onmessage=function(t){var a=JSON.parse(t.data);"match"==a.type&&e.addTrade("GDAX",new Date(a.time),parseFloat(a.price),parseFloat(a.size),a.side)},t.onopen=function(){t.send(JSON.stringify({type:"subscribe",product_ids:["BTC-USD"]}))}},bitstamp:function(){(e.connections.bitstamp=e.connections.bitstamp?e.connections.bitstamp:new t("de504dc5763aeef9ff52")).subscribe("live_trades").bind("trade",function(t){e.addTrade("Bitstamp",new Date(1e3*t.timestamp),t.price,t.amount)})},bitfinex:function(){var t=e.connections.bitfinex=new WebSocket("wss://api.bitfinex.com/ws/2");t.onmessage=function(t){var a=JSON.parse(t.data);if(a&&a instanceof Array&&"tu"==a[1]){var n=a[2];e.addTrade("Bitfinex",new Date(n[1]),n[3],Math.abs(n[2]))}},t.onopen=function(){t.send(JSON.stringify({event:"subscribe",channel:"trades",symbol:"tBTCUSD"}))}}},e.socket_closers={gdax:function(){var t=e.connections.gdax;t&&(t.close(),e.connections.gdax=null)},bitstamp:function(){var t=e.connections.bitstamp;t&&t.unsubscribe("live_trades")},bitfinex:function(){var t=e.connections.bitfinex;t&&(t.close(),e.connections.bitfinex=null)}}};a.prototype.restoreSession=function(){this.getStorage()||(this.options={exchanges:{gdax:!0,bitfinex:!0,bitstamp:!0},max_trades:25})},a.prototype.getStorage=function(){var e=localStorage.getItem("blt_userdata");if(!e)return!1;var t=JSON.parse(e);return this.options=t.options,!0},a.prototype.saveStorage=function(){var e=this;localStorage.setItem("blt_userdata",JSON.stringify({options:e.options}))},a.prototype.addTrade=function(e,t,a,n){var i={exchange:e,date:t.getTime(),clock:moment(t).format("HH:mm:ss"),rate:a.toFixed(1),amount:n.toFixed(8)},s=this.trades.splice(this.getMaxTrades()-1);s.length&&this.removeTradeCallback&&this.removeTradeCallback(s.length),this.trades.splice(0,0,i);var o=0;if(this.trades.length>1){var r=this.trades[1].rate;o=100*(i.rate-r)/r}this.addTradeCallback&&this.addTradeCallback(i),this.lastPriceCallback&&this.lastPriceCallback(i.rate,o)},a.prototype.enableSocket=function(e){this.options.exchanges[e]=!0,this.socket_openers[e](),this.saveStorage()},a.prototype.disableSocket=function(e){this.options.exchanges[e]=!1,this.socket_closers[e](),this.saveStorage()},a.prototype.setMaxTrades=function(e){this.options.max_trades=parseInt(e),this.saveStorage()},a.prototype.getMaxTrades=function(){return this.options.max_trades},a.prototype.isExchangeEnabled=function(e){return this.options.exchanges[e]};var n=new a;e.fn.extend({tradesTable:function(){var e=this,t=this.find("tbody");return n.removeTradeCallback=function(e){t.find("tr").slice(-1*e).remove()},n.addTradeCallback=function(e){var a="<tr><td>"+e.exchange+"</td><td>"+e.clock+"</td><td>"+e.rate+"</td><td>"+e.amount+"</td></tr>";t.prepend(a)},e},lastPrice:function(){var e=this,t=e.find(".price"),a=e.find(".change");return n.lastPriceCallback=function(e,n){var i=n>0?"trending_up":0==n?"trending_flat":"trending_down",s=Math.abs(n).toFixed(3);t.html('<i class="material-icons small">attach_money</i>'+e),a.html('<i class="material-icons small">'+i+"</i>"+s+"%")},e},exchangeCheckbox:function(e){var t=this,a=n.isExchangeEnabled(e);return t.prop("checked",a),a&&n.enableSocket(e),t.change(function(){t.prop("checked")?n.enableSocket(e):n.disableSocket(e)}),t},maxTradeRadios:function(){var e=this;return e.each(function(e,t){this.value==n.getMaxTrades()&&(this.checked=!0)}),e.change(function(){n.setMaxTrades(this.value)}),e}}),e(function(){e(".modal").modal(),e(".button-collapse").sideNav(),e("#trades-table").tradesTable(),e("#last-price").lastPrice(),e("#enable-gdax").exchangeCheckbox("gdax"),e("#enable-bitfinex").exchangeCheckbox("bitfinex"),e("#enable-bitstamp").exchangeCheckbox("bitstamp"),e("input[type=radio][name=max-trades]").maxTradeRadios()})}(jQuery,Pusher);